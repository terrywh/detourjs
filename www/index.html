<!doctype html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>任务监控</title>
		<link rel="stylesheet" href="index.css">
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
		<script src="https://cdn.bootcss.com/vue/2.4.2/vue.min.js"></script>
		<script src="https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js"></script>
	</head>
	<body>
		<div class="container-fluid" id="app">
			<div class="row">
				<div class="col-5">
					<div class="row">
						<div class="col-6">
							<form class="form-inline mt-2" v-on:submit="filterTask">
								<div class="form-group input-group">
									<input type="text" class="form-control" placeholder="过滤" aria-label="task filter" v-model="taskFilter">
									<span class="input-group-btn">
										<button class="btn btn-light">🔍</button>
									</span>
								</div>
							</form>
							<ul class="list-group mt-2">
								<a v-for="task in tasks" href="#" 
									class="list-group-item list-group-item-action"
									v-bind:class="{active: task == activeTask}"
									v-on:click.prevent="selectTask(task)">
									{{task}}
								</a>
							</ul>
						</div>
						<div class="col-6">
							<form class="form-inline mt-2" v-on:submit="filterData">
								<div class="form-group input-group">
									<input type="text" class="form-control" placeholder="过滤" aria-label="data filter" v-model="dataFilter">
									<span class="input-group-btn">
										<button class="btn btn-light">🔍</button>
									</span>
								</div>
							</form>
							<ul class="list-group mt-2">
								<a v-for="data in datas" href="#" 
									class="list-group-item list-group-item-action"
									v-bind:class="{active: data == activeData}"
									v-on:click.prevent="selectData(data)">{{data}}</a>
							</ul>
						</div>
					</div>
				</div>
				<div class="col-7" ref="progress" id="progress">
					<form class="form-inline row mt-2" v-on:submit.prevent="startTask">
						<div class="input-group col-xl-9 col-md-6">
							<span class="input-group-addon">🛠️ 参数</span>
							<input type="text" class="form-control" v-model="activeArgv" />
						</div>
						<div class="col-xl-3 col-md-6">
							<button type="submit" class="btn btn-info" v-bind="{disabled: taskStatus > 0 || !activeTask}">
								▶️ 启动
							</button>
							<button type="button" class="btn btn-info" v-bind="{disabled: taskStatus < 3}" v-on:click="killTask">
								🛑 终止
							</button>
						</div>
					</form> 
					<div class="list-group mt-2 mb-4">
						<li v-for="poll in taskPoll" class="list-group-item"
								v-bind:class="{'list-group-item-danger': poll.status == -203 || poll.status == -200, 'list-group-item-success': poll.status != -203 && poll.status != -200}">

							<small v-if="poll.status != -100" class="float-right text-secondary">{{parseInt(poll.time/1000*10)/10}}s</small>

							<div v-if="poll.status == -100" class="text-center"><strong>{{poll.data}}</strong></div>
							<span v-if="poll.status == -101">✴️ 任务开始</span>
							<span v-if="poll.status == 0">🕑 步骤： <code>{{poll.data}}</code></span>
							<span v-if="poll.status == -201">✔️ 完成： <code>{{poll.data}}</code></span>
							<pre v-if="poll.status > 0"><code>{{poll.data}}</code></pre>
							<span v-if="poll.status == -202">✅ 任务结束</span>
							<pre v-if="poll.status == -203">❌ {{poll.data}}</pre>
							<span v-if="poll.status == -200">❌ 无法获取任务状态</span>
						</li>
						<li class="list-group-item" v-if="taskLast.status != -200 && taskLast.status != -202 && taskLast.status != -203">
							<i class="loader">...</i>
						</li>
					</div>
				</div>
			</div>
		</div>
		<script src="index.js"></script>
	</body>
</html>