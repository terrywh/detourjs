<!doctype html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>任务监控</title>
		<link rel="stylesheet" href="index.css">
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
		<script src="https://cdn.bootcss.com/vue/2.4.2/vue.min.js"></script>
		<script src="https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js"></script>
	</head>
	<body>
		<div class="container-fluid" id="app">
			<div class="row">
				<div class="col-5">
					<div class="row">
						<div class="col-6">
							<form class="mt-2" v-on:submit.prevent="filterTask">
								<div class="form-group input-group">
									<span class="input-group-addon">🖨️ 定义</span>
									<input type="text" class="form-control" placeholder="过滤" aria-label="task filter" v-model="taskFilter">
									<span class="input-group-btn">
										<button class="btn btn-light">🔍</button>
									</span>
								</div>
							</form>
							<ul class="list-group mt-2">
								<li class="list-group-item list-group-item-danger" v-if="tasks.length == 0">
									❌ 看啥看，服务都完蛋了，能加载出来才诡异！
								</li>
								<a v-for="task in tasks" v-show="!task.hide" href="#" 
									class="list-group-item list-group-item-action"
									v-bind:class="{active: task.file == taskName}"
									v-on:click.prevent="setTask(task)">{{task.file}}</a>
							</ul>
						</div>
						<div class="col-6">
							<form class="mt-2" v-on:submit.prevent="filterData">
								<div class="form-group input-group">
									<span class="input-group-addon">🖨️ 数据</span>
									<input type="text" class="form-control" placeholder="过滤" aria-label="data filter" v-model="dataFilter">
									<span class="input-group-btn">
										<button class="btn btn-light">🔍</button>
									</span>
								</div>
							</form>
							<ul class="list-group mt-2">
								<a href="#" 
									class="list-group-item list-group-item-action"
									v-bind:class="{active: '' == taskData}"
									v-on:click.prevent="setData({file: '', hide: false})">/empty.js <span class="float-right text-secondary">(空数据)</span></a>
								<a v-for="data in datas" v-show="!data.hide" href="#" 
									class="list-group-item list-group-item-action"
									v-bind:class="{active: data.file == taskData}"
									v-on:click.prevent="setData(data)">{{data.file}}</a>
							</ul>
						</div>
					</div>
				</div>
				<div class="col-7" ref="progress">
					<form class="mt-2" v-on:submit.prevent="">
						<div class="input-group">
							<span class="input-group-addon">🛠️ 参数</span>
							<input type="text" class="form-control" v-bind:value="taskArgv" v-on:change="setArgv($event.target.value)" />
							<span class="input-group-btn">
								<button v-on:click="startTask" type="button" class="btn btn-info" v-bind="{disabled: taskStat > 0 || !taskName}">
									▶️ 启动
								</button>
							</span>
							<span class="input-group-btn">
								<button v-on:click="killTask" type="button" class="btn btn-info" v-bind="{disabled: taskStat < 2}" v-on:click="killTask">
									🛑 终止
								</button>
							</span>
						</div>
					</form> 
					<div class="list-group mt-2 mb-4" v-cloak>
						<li v-for="poll in taskPoll" class="list-group-item"
								v-bind:class="{'list-group-item-light': poll.status == -100 || poll.status == -200, 'list-group-item-info': poll.status > 0 && poll.data.substr(0,2) == 'i:', 'list-group-item-warning': poll.status > 0 && poll.data.substr(0,2) == 'w:', 'list-group-item-danger': poll.status == -203 || poll.status == -204 || poll.status== -205, 'list-group-item-warning': poll.status == -206}">

							<small v-if="poll.status != -100 && poll.status != -200" class="float-right badge badge-light badge-pill">{{parseInt(poll.time/1000*10)/10}}s</small>

							<div v-if="poll.status == -100">
								<h5>
									{{poll.data.name}}
									<small><span class="text-secondary">{{poll.data.data}}</span></small>
								</h5>
								<div>
									<small><span class="text-secondary">{{poll.data.argv}}</span></small>
								</div>
							</div>
							<span v-if="poll.status == -101">✴️ 任务开始</span>
							<span v-if="poll.status == 0">🕑 步骤： <code>{{poll.data}}</code></span>
							<span v-if="poll.status == -201">✔️ 完成： <code>{{poll.data}}</code></span>
							<pre v-if="poll.status > 0"><code>{{poll.data.substr(2)}}</code></pre>
							<span v-if="poll.status == -202">✅ 任务结束</span>
							<pre v-if="poll.status == -203">❌ {{poll.data}}</pre>
							<pre v-if="poll.status == -204">❌ 错误：无法获取任务状态，任务可能还在运行~</pre>
							<pre v-if="poll.status == -205">❌ 错误：无法获取任务状态，任务可能没有启动~</pre>
							<pre v-if="poll.status == -206">⏹️ 终止：由于任务被用户提前终止，无法确认任务执行结果~</pre>
							<span v-if="poll.status == -200"></span>
						</li>
						<li class="list-group-item" v-if="taskLast.status != -200 && taskLast.status != -202 && taskLast.status != -203">
							<i class="loader">...</i>
						</li>
					</div>
				</div>
			</div>
		</div>
		<script src="index.js"></script>
	</body>
</html>